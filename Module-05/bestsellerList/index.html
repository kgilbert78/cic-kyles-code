<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kyle's New York Times Bestseller List</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <!-- <link rel="stylesheet" href="style.css" /> -->
    <style>
        h3 {
            font-size: 1.25rem;
        }

        .coverImgDiv {
            height: 150px;
        }

        .coverImg {
            max-height: 100%;
        }

        input {
            visibility: hidden;
        }
    </style>
</head>
<body class="mx-2 my-2">
    <!-- <nav class="navbarTop navbar navbar-light">
        <div class="container-fluid flex-row" id="navLinks"></div>
        </div>
    </nav> -->
    <main class="mainContent">
        <h1 id="top">This Week's New York Times Bestseller List</h1>
            <div class="d-flex flex-row">
            <div class="col-9" id="bestsellerLists">
            </div>
            <div class="col-3">
                <div id="navLinks">
                    <h3>Jump to a category:</h3>
                </div>
                <div id="readingList" class="mt-5">
                    <h3>My Reading List</h3>
                    <ul id="list"> <!-- link to updateHTML function with this ID -->
                        <li>Nothing to read yet!</li>
                    </ul> 
                </div>
            </div>
           
        </div>
    </main>
</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://api.nytimes.com/svc/books/v3/lists/overview.json"></script>
<script>
    let bestsellerDiv = document.getElementById("bestsellerLists");
    let promise = axios.get('https://api.nytimes.com/svc/books/v3/lists/overview.json?api-key=YC7F434qQ2icxGUGalXKqVKPXQ0ZqDGv', {headers:{"Accept": "application/json"}});
        promise.then(function(response){
            console.log(response.status);
            let bestsellerData = JSON.stringify(response.data);
            let bestsellerContent = "";

            let categories = response.data.results.lists;
            for (let categoryIndex = 0; categoryIndex < categories.length; categoryIndex++) {
            // for (category of categories) {
                const categoryDiv = document.createElement("div");
                const categoryNames = categories[categoryIndex].display_name;
                // const categoryNames = category.display_name;
                const navLinks = document.getElementById("navLinks");
                // console.log(categoryNames);
                categoryDiv.className = "categoryDiv mx-2 my-4 border";
                categoryDiv.innerHTML = `<a id="${categoryNames}"><h2 class="my-4">${categoryNames}</h2></a> <a href="#top">Return to top</a>`; 
                navLinks.innerHTML += `<div><a href="#${categoryNames}">${categoryNames}</a></div>`;
                // navLinks.innerHTML += `<div class="col-3"><a href="#${categoryNames}">${categoryNames}</a></div>`;
                bestsellerContent += categoryDiv.innerHTML;
                //console.log(bestsellerContent);
                let books = categories[categoryIndex].books;
                for (let bookIndex = 0; bookIndex < books.length; bookIndex++) {
                // for (book of books) {
                    const bookDiv = document.createElement("div");
                    let title = books[bookIndex].title;
                    // let title = book.title;
                    let author = books[bookIndex].author;
                    let description = books[bookIndex].description;
                    let coverImg = books[bookIndex].book_image;
                    let amazonLink = books[bookIndex].buy_links[0].url;
                    bookDiv.innerHTML = 
                        `<div class="d-flex flex-row mx-2 my-4">
                            <div class="coverImgDiv col-1">
                                <a href="${amazonLink}" target="_blank">
                                    <img class="coverImg img-fluid" src="${coverImg}" />
                                </a>
                            </div>
                            <div></div>
                            <div class="col-8 mx-2">
                                <div class="titleDiv">
                                    <h3>${books[bookIndex].rank}. ${title}, by ${author}</h3>
                                </div>
                            <div class="descriptionDiv">
                                ${description}
                                </div>
                            </div>
                            <div>
                                <form onsubmit="addBook(event)">
                                    ${/* <form onsubmit="${addBook(event)}"> executes `addBook` IMMEDIATELY when looping to generate the HTML and interpolates the return value of the function into the string. The code below embeds the string containing addBook into the onsubmit attribute of the tag so the literal string is added to the DOM node when it's created */" "}
                                    <input type="text" placeholder="Enter new book here." id="newBookInput" />
                                    ${/* id="${title}" returns <li>::marker "null"</li> */" "}
                                    <button type="submit" class="btn btn-sm btn-primary">Add to Reading List</button>
                                </form>
                            </div>
                        </div>`
                    bestsellerContent += bookDiv.innerHTML;
                };
            };
            // attempt to get "Return to top" link to show up at the end of the category
            // for (let categoryIndex = 0; categoryIndex < categories.length; categoryIndex++) {
            //     let backToTop = `<a href="#top">Return to top</a>`;
            //     categoryDiv.innerHTML += backToTop;
            // }
            bestsellerDiv.innerHTML = bestsellerContent;
        });

        let readingList = [];

        function addBook(event) {
            event.preventDefault();
            let newBook = document.getElementById("newBookInput"); // getElementById(title) doesn't work if id="${title}" How do you set a single id (like a variable) when it's looping through an object? I thought making an invisible input field that fills with the book name would work if I could figure out how to make the button fill the input field with a set value (from the object), but I couldn't figure out how to do that.
            readingList.push(newBook); // returns <li>::marker "[object HTMLInputElement]"</li> in console (marker is the css for the list item dot)
            newBook = ""; 
            // readingList.push(newBook.value); // returns <li>::marker </li> in console (marker is the css for the list item dot)
            // newBook.value = "";
            updateHTML();
        }

        function updateHTML() {
            const list = document.getElementById("list"); 
            let htmlToUpdate = "";
            for (let readingListIndex = 0; readingListIndex < readingList.length; readingListIndex++) {
            // for (book of readingList) {
                htmlToUpdate += `<li>${readingList[readingListIndex]}</li>`;
                // htmlToUpdate += `<li>${book}</li>`; 
                
                // Add buttons to remove book or mark as read by changing font color to gray and increasing opacity of cover image if displayed here. Pass index for use inside remove function to tell it which array item to delete.
                // <button onclick="removeButtonPressed(${readingListIndex})">Remove</button>
                // <button onclick="readButtonPressed(${readingListIndex})">I read this!</button>
            }
            list.innerHTML = htmlToUpdate;
            console.log(list);
        };
</script>
</html>